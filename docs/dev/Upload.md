This page describes how to retrieve data from Local DB.

## Requirements

- DAQ Server with [required libraries installed](https://github.com/jlab-hep/Yarr/wiki/Installation)
- DB Server with [required libraries installed](https://github.com/jlab-hep/Yarr/wiki/Installation)
- Setup DAQ system: [setup_db.sh](https://github.com/jlab-hep/Yarr/wiki/Setup-DAQ-Server)

## Upload Tool

### Check Connection

   ```bash
   $ localdbtool-upload init
   #DB INFO# Local DB Server: mongodb://127.0.0.1:27017
   #DB INFO# ---> connection is good.
   ```
   Additional options:
   - **--database ``<database config>``** : Set database config file (default: `${HOME}/.yarr/localdb/database.json`).
 
### Upload Scan 

   You can upload data from the result directory of YARR by `localdbtool-upload`.
   
   **This function supports not only uploading from the result directory generated by `scanConsole -W` but also uploading from the result directory generated by `scanConsole`.**<br>
   **But in uploading from the result directory generated by `scanConsole`, there might be some loss in the uploaded data.**

   ```bash
   $ localdbtool-upload scan <path/to/result/dir>
   e.g.) $ localdbtool-upload scan ./data/last_scan
   #DB INFO# Local DB Server: mongodb://127.0.0.1:27017
   #DB INFO# ---> connection is good.
   #DB INFO# Cache Directory: ./data/last_scan/
   #DB INFO# Success
   ```
   Additional options:
   - **--database ``<database config>``** : Set database config file (default: `${HOME}/.yarr/localdb/database.json`).
   - **--user ``<user config>``** : Set user config file (default: `${HOME}/.yarr/localdb/user.json`).
   - **--site ``<site config>``** : Set site config file (default: `${HOME}/.yarr/localdb/site.json`).
   - **--log** : Set logging mode (default 'False'). If set 'True', the output log is written in `${HOME}/.yarr/localdb/log/day.log`.
   - **--username ``<username>``** : Set username of the Local DB Server if the users authenticated is needed.
   - **--password ``<password>``** : Set password of the Local DB Server if the users authenticated is needed.
   - **--config ``<config file>``** : Set config file which username and password are written in if the users authenticated is needed.

### Upload Cache

   When you could not upload Scan/DCS data by `scanConsole -W`/`dbAccessor -E` because of the bad connection to Local DB Server,<br>
   the cache data and log file ('scanLog.json'/'dbDcsLog.json') would be stored in the result directory, <br>
   and that record is written to the file: `${HOME}/.yarr/run.dat`/`${HOME}/.yarr/dcs.dat`. 

   In the good connection to Local DB Server, you can upload all cache data by `localdbtool-upload cache`

   ```bash
   $ localdbtool-upload cache
   #DB INFO# Local DB Server: mongodb://127.0.0.1:27017
   #DB INFO# ---> connection is good.
   #DB INFO# Cache Directory: /home/USER/XXX
   #DB INFO# Success
   ```
   
### Check Uploaded Component Data

   You can check all component data stored in Local DB Server by `localdbtool-upload check`

   ```bash
   $ localdbtool-upload check
   #DB INFO# Local DB Server: mongodb://127.0.0.1:27017
   #DB INFO# ---> connection is good.
   #DB INFO# Download Component Data of Local DB locally...
   #DB INFO# --------------------------------------
   #DB INFO# Component (1)
   #DB INFO#     Chip Type: FE-I4B
   #DB INFO#     Module:
   #DB INFO#         serial number: QU-09
   #DB INFO#         component type: Module
   #DB INFO#         chips: 4
   #DB INFO#     Chip (1):
   #DB INFO#         serial number: QU-09_chipId1
   #DB INFO#         component type: Front-end Chip
   #DB INFO#         chip ID: 1
   #DB INFO#     Chip (2):
   #DB INFO#         serial number: QU-09_chipId2
   #DB INFO#         component type: Front-end Chip
   #DB INFO#         chip ID: 2
   #DB INFO#     Chip (3):
   #DB INFO#         serial number: QU-09_chipId3
   #DB INFO#         component type: Front-end Chip
   #DB INFO#         chip ID: 3
   #DB INFO#     Chip (4):
   #DB INFO#         serial number: QU-09_chipId4
   #DB INFO#         component type: Front-end Chip
   #DB INFO#         chip ID: 4
   #DB INFO# --------------------------------------
   <ctrl+C>
   ```
